schema: '2.0'
stages:
  download-pollutants:
    cmd: python airpollpredictor/download_pollutants.py --service_url http://127.0.0.1:8040
      --params params.yaml
    deps:
    - path: airpollpredictor/download_pollutants.py
      md5: e73c33adeac84bcc1ebf8105824e8cb4
      size: 597
    params:
      params.yaml:
        download-pollutants:
          end_point_current_year: download_current_year
          request_params_current_year:
            load_params:
              save_dir_path: datasets/pollutants-source-data/
              country_code: NL
              city: Rotterdam
              stations_per_pollutants:
                '7': STA-NL00418
                '5': STA-NL00418
                '6001': STA-NL00448
                '8': STA-NL00418
    outs:
    - path: airpollpredictor/datasets/pollutants-source-data/5/NL_5_28280_2023_timeseries.csv
      md5: cccccd5ee3e6074fffa4c8815b677c15
      size: 582643
    - path: airpollpredictor/datasets/pollutants-source-data/6001/NL_6001_28131_2023_timeseries.csv
      md5: 61b56a1ae9f5b3cf837202f229288cc0
      size: 587414
    - path: airpollpredictor/datasets/pollutants-source-data/7/NL_7_28284_2023_timeseries.csv
      md5: a2d28e20084ef563b8f09a2fbac136df
      size: 574103
    - path: airpollpredictor/datasets/pollutants-source-data/8/NL_8_28398_2023_timeseries.csv
      md5: 7977c5ba3c4e98bb2846eaa40d4e8e50
      size: 578471
    - path: airpollpredictor/datasets/pollutants-source-data/urls/5.txt
      md5: 8f8e8a8b01a41abb25f5672f6e5c5e1d
      size: 95
    - path: airpollpredictor/datasets/pollutants-source-data/urls/6001.txt
      md5: f5a8934d7d89adf6c676bcdc3b25cf00
      size: 98
    - path: airpollpredictor/datasets/pollutants-source-data/urls/7.txt
      md5: 4e6417d315785f1c699c8810182c97af
      size: 95
    - path: airpollpredictor/datasets/pollutants-source-data/urls/8.txt
      md5: 94c2961eec0573b618ed2e0eeb335cd4
      size: 95
  download-weather:
    cmd: python airpollpredictor/download_weather.py --service_url http://127.0.0.1:8041
      --params params.yaml
    deps:
    - path: airpollpredictor/download_weather.py
      md5: 19c8857b0ec573a9722c46b66f19cdec
      size: 558
    params:
      params.yaml:
        download-weather:
          end_point_current_year: download_current_year
          request_params_current_year:
            load_params:
              save_file_path: datasets/weather-source-data/weather.csv
              station_id: '06344'
    outs:
    - path: airpollpredictor/datasets/weather-source-data/weather.csv
      md5: 303f270dfdfdf0ef1246bc81b80ea4f5
      size: 5470
  clean-pollutants:
    cmd: python airpollpredictor/clean_pollutants.py --input_folder airpollpredictor/datasets/pollutants-source-data/
      --output_folder airpollpredictor/datasets/pollutants-clean-data/ --params params.yaml
    deps:
    - path: airpollpredictor/clean_pollutants.py
      md5: f56c8db6c180d8f340c2695d18537efb
      size: 1640
    - path: airpollpredictor/datasets/pollutants-source-data/5/NL_5_28280_2023_timeseries.csv
      md5: cccccd5ee3e6074fffa4c8815b677c15
      size: 582643
    - path: airpollpredictor/datasets/pollutants-source-data/6001/NL_6001_28131_2023_timeseries.csv
      md5: 61b56a1ae9f5b3cf837202f229288cc0
      size: 587414
    - path: airpollpredictor/datasets/pollutants-source-data/7/NL_7_28284_2023_timeseries.csv
      md5: a2d28e20084ef563b8f09a2fbac136df
      size: 574103
    - path: airpollpredictor/datasets/pollutants-source-data/8/NL_8_28398_2023_timeseries.csv
      md5: 7977c5ba3c4e98bb2846eaa40d4e8e50
      size: 578471
    params:
      params.yaml:
        pollutants-codes:
        - 7
        - 6001
        - 5
        - 8
    outs:
    - path: airpollpredictor/datasets/pollutants-clean-data/5.csv
      md5: f63a34544fe45d00d1dd8eaf9f8a82eb
      size: 68936
    - path: airpollpredictor/datasets/pollutants-clean-data/6001.csv
      md5: 62a956052e5353eebe63b33565528981
      size: 71539
    - path: airpollpredictor/datasets/pollutants-clean-data/7.csv
      md5: 802aef9b6c6826a621309c4fc795bbf8
      size: 70224
    - path: airpollpredictor/datasets/pollutants-clean-data/8.csv
      md5: 8fe60ea610c3e5f7ddaacf8075c64491
      size: 70726
  calculate-aqi:
    cmd: python airpollpredictor/calculate_aqi.py --input_folder airpollpredictor/datasets/pollutants-clean-data/
      --output_folder airpollpredictor/datasets/pollutants-aqi-data/ --params params.yaml
    deps:
    - path: airpollpredictor/calculate_aqi.py
      md5: 50d92402c0c9b590db7728635d264f8b
      size: 1031
    - path: airpollpredictor/datasets/pollutants-clean-data/5.csv
      md5: f63a34544fe45d00d1dd8eaf9f8a82eb
      size: 68936
    - path: airpollpredictor/datasets/pollutants-clean-data/6001.csv
      md5: 62a956052e5353eebe63b33565528981
      size: 71539
    - path: airpollpredictor/datasets/pollutants-clean-data/7.csv
      md5: 802aef9b6c6826a621309c4fc795bbf8
      size: 70224
    - path: airpollpredictor/datasets/pollutants-clean-data/8.csv
      md5: 8fe60ea610c3e5f7ddaacf8075c64491
      size: 70726
    params:
      params.yaml:
        pollutants-codes:
        - 7
        - 6001
        - 5
        - 8
    outs:
    - path: airpollpredictor/datasets/pollutants-aqi-data/5.csv
      md5: 5b7424a36bbd1f669e77ace9fdb92a18
      size: 2990
    - path: airpollpredictor/datasets/pollutants-aqi-data/6001.csv
      md5: 1ef9d5cc69420a73215f7d07ae69e5b1
      size: 3005
    - path: airpollpredictor/datasets/pollutants-aqi-data/7.csv
      md5: a40060fdd98c1a13b7effddc7e35c087
      size: 2993
    - path: airpollpredictor/datasets/pollutants-aqi-data/8.csv
      md5: 220854853f5b6652ead98e454d4fcff9
      size: 2994
  enrich-pollutants:
    cmd: python airpollpredictor/enrich_pollutants.py --input_folder airpollpredictor/datasets/pollutants-clean-data/
      --output_file airpollpredictor/datasets/pollutants-enrich-data/aqi_enriched.csv
      --params params.yaml
    deps:
    - path: airpollpredictor/datasets/pollutants-clean-data/5.csv
      md5: f63a34544fe45d00d1dd8eaf9f8a82eb
      size: 68936
    - path: airpollpredictor/datasets/pollutants-clean-data/6001.csv
      md5: 62a956052e5353eebe63b33565528981
      size: 71539
    - path: airpollpredictor/datasets/pollutants-clean-data/7.csv
      md5: 802aef9b6c6826a621309c4fc795bbf8
      size: 70224
    - path: airpollpredictor/datasets/pollutants-clean-data/8.csv
      md5: 8fe60ea610c3e5f7ddaacf8075c64491
      size: 70726
    - path: airpollpredictor/enrich_pollutants.py
      md5: 38bf4a199a12524f57ed71263ad6bd5f
      size: 2058
    params:
      params.yaml:
        enrich-pollutants:
          lags-shifts:
          - 7
          - 10
          - 12
          - 14
          - 21
          - 28
          filters:
          - weekday
          - month
          windows_filters_aqi:
            NoFilter:
            - 3D
            - 5D
            - 7D
            - 14D
            - 28D
            weekday:
            - 28D
            - 56D
            month:
            - 90D
          lag_agg_aqi:
          - 7
          - 10
          - 14
          - 21
          - 28
          methods_agg_aqi:
          - mean
          - median
          - percentile(10)
          - percentile(90)
          ewm_filters_aqi:
            NoFilter:
            - 7
            - 14
            - 21
            - 28
            weekday:
            - 28
            - 56
            month:
            - 90
        period-settings:
          year_start_train: 2023
          forecast_period: 7
        pollutants-codes:
        - 7
        - 6001
        - 5
        - 8
    outs:
    - path: airpollpredictor/datasets/pollutants-enrich-data/aqi_enriched.csv
      md5: dc99907e715129970b90504bc0fdd49c
      size: 882836
  clean-weather:
    cmd: python airpollpredictor/clean_weather.py --input_file airpollpredictor/datasets/weather-source-data/weather.csv
      --output_file airpollpredictor/datasets/weather-clean-data/weather.csv --params
      params.yaml
    deps:
    - path: airpollpredictor/clean_weather.py
      md5: dd04abbd780339c722303be116e0e5cb
      size: 1071
    - path: airpollpredictor/datasets/weather-source-data/weather.csv
      md5: 303f270dfdfdf0ef1246bc81b80ea4f5
      size: 5470
    params:
      params.yaml:
        weather-features:
        - tavg
        - tmin
        - tmax
        - prcp
        - wdir
        - wspd
        - wpgt
        - pres
    outs:
    - path: airpollpredictor/datasets/weather-clean-data/weather.csv
      md5: 1ad2c6b6a8cdf6fb82c573e6fa54f977
      size: 5252
  merge_enriched_weather:
    cmd: python airpollpredictor/dvc_steps/merge_enriched_weather.py --input_weather_prev_years_file
      airpollpredictor/datasets/weather-clean-data/weather_prev_years.csv --input_weather_cur_year_file
      airpollpredictor/datasets/weather-clean-data/weather_cur_year.csv --input_aqi_prev_years_file
      airpollpredictor/datasets/pollutants-enrich-data/aqi_enriched_prev_years.csv
      --input_aqi_cur_year_file airpollpredictor/datasets/pollutants-enrich-data/aqi_enriched_cur_year.csv
      --output_file airpollpredictor/datasets/pollutants-weather-merged-data/aqi_all.csv
      --params params.yaml
    deps:
    - path: airpollpredictor/datasets/pollutants-enrich-data/aqi_enriched_cur_year.csv
      md5: 3549c701d24efbd78e4fc4d24f0ee2d0
      size: 313868
    - path: airpollpredictor/datasets/pollutants-enrich-data/aqi_enriched_prev_years.csv
      md5: 668232e70ddd0b78d2c3637ca31f98f4
      size: 5107413
    - path: airpollpredictor/datasets/weather-clean-data/weather_cur_year.csv
      md5: a0b0a2e82093a10566dc4a19e3ee1595
      size: 19317
    - path: airpollpredictor/datasets/weather-clean-data/weather_prev_years.csv
      md5: 51da348ade83b28a04c30bf9d9a94877
      size: 278086
    - path: airpollpredictor/dvc_steps/merge_enriched_weather.py
      md5: 8aa7f24952d8d5c2c82cba22e1722ae2
      size: 1568
    outs:
    - path: airpollpredictor/datasets/pollutants-weather-merged-data/aqi_all.csv
      md5: 1e1f25048b784b033a894f42a26e39f0
      size: 5580368
  filter_columns_lgbm_pm_25:
    cmd: python airpollpredictor/dvc_steps/filter_columns_for_model.py --input_file
      airpollpredictor/datasets/pollutants-weather-merged-data/aqi_all.csv --output_file
      airpollpredictor/experiments_results/lgbm/6001/aqi_filtered.csv --params params.yaml
      --params_section lgbm_pm25
    deps:
    - path: airpollpredictor/datasets/pollutants-weather-merged-data/aqi_all.csv
      md5: 1e1f25048b784b033a894f42a26e39f0
      size: 5580368
    - path: airpollpredictor/dvc_steps/filter_columns_for_model.py
      md5: f2029e47463ad4247fc2f6631aa9b524
      size: 2575
    params:
      params.yaml:
        columns_filters_gen: &id001
          use_aqi_cols: true
          use_c_mean_cols: false
          use_c_max_cols: false
          use_c_median_cols: false
          use_c_min_cols: false
          use_pol_cols: false
          use_lag_cols: false
          use_gen_lags_cols: true
          use_weather_cols: true
          pollutants_codes:
          - 6001
          weather_columns:
          - tavg
          - tmin
          - tmax
          - prcp
          - wdir
          - wspd
          - wpgt
          - pres
          date_columns:
          - weekday
          - day
          - month
          - year
          - season
          - is_weekend
          - is_new_year
        lgbm_pm25:
          exp_name: lgbm_pm25
          run_name: outliers_no_gen_lags_no
          pol_id: 6001
          categories:
          - month
          - weekday
          default_category:
          - month
          - weekday
          search_category: false
          default_top_features_count: 30
          default_params:
            n_jobs: -1
            verbosity: -1
            objective: regression
            metric: rmse
            boosting_type: gbdt
            extra_trees: true
            n_estimators: 2100
            num_leaves: 100
            learning_rate: 0.01
            subsample: 0.7
            subsample_freq: 5
            subsample_for_bin: 100000
            min_child_samples: 30
            reg_alpha: 0.1
            reg_lambda: 0.3
            max_depth: 10
            max_bin: 200
          prediction_value_type: AQI
          columns_filters: *id001
          columns_selected:
          - AQI_PM25
          - month
          - weekday
          - Wx
          - Wy
          - tmin
          - prcp
    outs:
    - path: airpollpredictor/experiments_results/lgbm/6001/aqi_filtered.csv
      md5: b1f5109404771e34f28edbfdf24472dd
      size: 197175
  split_train_val_lgbm_pm_25:
    cmd: python airpollpredictor/dvc_steps/split_train_val.py --input_file airpollpredictor/experiments_results/lgbm/6001/aqi_filtered.csv
      --output_train_file airpollpredictor/experiments_results/lgbm/6001/train.csv
      --output_val_file airpollpredictor/experiments_results/lgbm/6001/val.csv --params
      params.yaml
    deps:
    - path: airpollpredictor/dvc_steps/split_train_val.py
      md5: 6008f0bceaee7b37e16350943013a6f3
      size: 1936
    - path: airpollpredictor/experiments_results/lgbm/6001/aqi_filtered.csv
      md5: b1f5109404771e34f28edbfdf24472dd
      size: 197175
    params:
      params.yaml:
        split_periods:
          train_date_to: '2023-04-30'
          val_date_to: '2023-05-17'
          forecast_period: 7
          remove_days_at_start: 90
    outs:
    - path: airpollpredictor/experiments_results/lgbm/6001/train.csv
      md5: d3f0f0e5efbeca820f3800595ac7c316
      size: 189277
    - path: airpollpredictor/experiments_results/lgbm/6001/val.csv
      md5: 910c9d29c3fd830df376bfb4d2d52805
      size: 511
  download-pollutants-cur-year:
    cmd: python airpollpredictor/dvc_steps/download_pollutants.py --output_folder
      airpollpredictor/datasets/pollutants-source-data/cur_year --params params.yaml
      --params_section download-pollutants-cur-year
    deps:
    - path: airpollpredictor/dvc_steps/download_pollutants.py
      md5: 51ced3e209148cfc2a2796f0b50d3be2
      size: 1660
    params:
      params.yaml:
        download-pollutants-cur-year:
          country_code: NL
          city: Rotterdam
          stations_per_pollutants:
            '6001': STA-NL00448
          date_from: '2023-01-01'
          date_to: '2023-06-17'
    outs:
    - path: airpollpredictor/datasets/pollutants-source-data/cur_year/6001/NL_6001_28131_2023_timeseries.csv
      md5: 24ffd9352ebd648b1758a9cedc9d0125
      size: 1000731
    - path: airpollpredictor/datasets/pollutants-source-data/cur_year/urls/6001.txt
      md5: f5a8934d7d89adf6c676bcdc3b25cf00
      size: 98
  download-pollutants-prev-years:
    cmd: python airpollpredictor/dvc_steps/download_pollutants.py --output_folder
      airpollpredictor/datasets/pollutants-source-data/prev_years --params params.yaml
      --params_section download-pollutants-prev-years
    deps:
    - path: airpollpredictor/dvc_steps/download_pollutants.py
      md5: 51ced3e209148cfc2a2796f0b50d3be2
      size: 1660
    params:
      params.yaml:
        download-pollutants-prev-years:
          country_code: NL
          city: Rotterdam
          stations_per_pollutants:
            '6001': STA-NL00448
          date_from: '2015-01-01'
          date_to: '2022-12-31'
    outs:
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_28131_2015_timeseries.csv
      md5: 22fe5f0f183997def0f4e0a38e767620
      size: 2315911
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_28131_2016_timeseries.csv
      md5: 25ff483a6d839c81df26389b57399c94
      size: 2320937
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_28131_2017_timeseries.csv
      md5: 8e062b6f979917e6a7b25026b12caf94
      size: 2313696
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_28131_2019_timeseries.csv
      md5: fca82d3f14d999eddaab93298e08c03c
      size: 2214296
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_28131_2020_timeseries.csv
      md5: fbcb5529583181bee41be09031b8b744
      size: 2189693
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_28131_2021_timeseries.csv
      md5: fdf2b90c0ab0c49f1641e1f80da5fc10
      size: 2215843
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_28131_2022_timeseries.csv
      md5: 18d3e6f4b1b923f53218b43f0227fee0
      size: 2228044
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_50425_2018_timeseries.csv
      md5: d4aa77bd59f3969e8f084d1ff1e01e99
      size: 2307489
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_50425_2019_timeseries.csv
      md5: b1922057fa886b83ed2d45f382bdf769
      size: 2304910
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_50425_2020_timeseries.csv
      md5: 6f94b166cbca1390609bca7ce0bb7054
      size: 2312703
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/urls/6001.txt
      md5: 428dfa265b89e87203d7511f9ead9eef
      size: 1033
  download-weather-cur-year:
    cmd: python airpollpredictor/dvc_steps/download_weather.py --output_file airpollpredictor/datasets/weather-source-data/weather_cur_year.csv  --params
      params.yaml --params_section download-weather-cur-year
    deps:
    - path: airpollpredictor/dvc_steps/download_weather.py
      md5: 1ee85f42677426374d2d42d6821f2cb9
      size: 1326
    params:
      params.yaml:
        download-weather-cur-year:
          station_id: '06344'
          date_from: '2023-01-01'
          date_to: '2023-06-17'
    outs:
    - path: airpollpredictor/datasets/weather-source-data/weather_cur_year.csv
      md5: 843fba2a74885ec79784ccb49b1f77da
      size: 8886
  download-weather-prev-years:
    cmd: python airpollpredictor/dvc_steps/download_weather.py --output_file airpollpredictor/datasets/weather-source-data/weather_prev_years.csv
      --params params.yaml --params_section download-weather-prev-years
    deps:
    - path: airpollpredictor/dvc_steps/download_weather.py
      md5: 1ee85f42677426374d2d42d6821f2cb9
      size: 1326
    params:
      params.yaml:
        download-weather-prev-years:
          station_id: '06344'
          date_from: '2015-01-01'
          date_to: '2022-12-31'
    outs:
    - path: airpollpredictor/datasets/weather-source-data/weather_prev_years.csv
      md5: b9d38a01d54e3315e09e866a9eceb3fe
      size: 141092
  clean-pollutants-cur-year:
    cmd: python airpollpredictor/dvc_steps/clean_pollutants.py --input_folder airpollpredictor/datasets/pollutants-source-data/cur_year/
      --output_folder airpollpredictor/datasets/pollutants-clean-data/cur_year/ --params
      params.yaml
    deps:
    - path: airpollpredictor/datasets/pollutants-source-data/cur_year/6001/NL_6001_28131_2023_timeseries.csv
      md5: 24ffd9352ebd648b1758a9cedc9d0125
      size: 1000731
    - path: airpollpredictor/dvc_steps/clean_pollutants.py
      md5: 21c77ce4ebc80281c86d540dfeb6e74d
      size: 1623
    params:
      params.yaml:
        pollutants-codes:
        - 6001
    outs:
    - path: airpollpredictor/datasets/pollutants-clean-data/cur_year/6001.csv
      md5: 1885f8465494136d0947827a48b7eeb6
      size: 121311
  clean-pollutants-prev-years:
    cmd: python airpollpredictor/dvc_steps/clean_pollutants.py --input_folder airpollpredictor/datasets/pollutants-source-data/prev_years/
      --output_folder airpollpredictor/datasets/pollutants-clean-data/prev_years/
      --params params.yaml
    deps:
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_28131_2015_timeseries.csv
      md5: 22fe5f0f183997def0f4e0a38e767620
      size: 2315911
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_28131_2016_timeseries.csv
      md5: 25ff483a6d839c81df26389b57399c94
      size: 2320937
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_28131_2017_timeseries.csv
      md5: 8e062b6f979917e6a7b25026b12caf94
      size: 2313696
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_28131_2019_timeseries.csv
      md5: fca82d3f14d999eddaab93298e08c03c
      size: 2214296
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_28131_2020_timeseries.csv
      md5: fbcb5529583181bee41be09031b8b744
      size: 2189693
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_28131_2021_timeseries.csv
      md5: fdf2b90c0ab0c49f1641e1f80da5fc10
      size: 2215843
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_28131_2022_timeseries.csv
      md5: 18d3e6f4b1b923f53218b43f0227fee0
      size: 2228044
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_50425_2018_timeseries.csv
      md5: d4aa77bd59f3969e8f084d1ff1e01e99
      size: 2307489
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_50425_2019_timeseries.csv
      md5: b1922057fa886b83ed2d45f382bdf769
      size: 2304910
    - path: airpollpredictor/datasets/pollutants-source-data/prev_years/6001/NL_6001_50425_2020_timeseries.csv
      md5: 6f94b166cbca1390609bca7ce0bb7054
      size: 2312703
    - path: airpollpredictor/dvc_steps/clean_pollutants.py
      md5: 21c77ce4ebc80281c86d540dfeb6e74d
      size: 1623
    params:
      params.yaml:
        pollutants-codes:
        - 6001
    outs:
    - path: airpollpredictor/datasets/pollutants-clean-data/prev_years/6001.csv
      md5: aca49fea594b1056c3fcdeb0fe1d566a
      size: 2387732
  enrich-pollutants-prev-years:
    cmd: python airpollpredictor/dvc_steps/enrich_pollutants.py --input_prev_years_folder
      airpollpredictor/datasets/pollutants-aqi-no-outliers-data/prev_years/ --output_file
      airpollpredictor/datasets/pollutants-enrich-data/aqi_enriched_prev_years.csv
      --params params.yaml --params_section enrich-pollutants-prev-years
    deps:
    - path: airpollpredictor/datasets/pollutants-aqi-no-outliers-data/prev_years/6001.csv
      md5: 0af31f3e60fbca686d4a03f1709db07a
      size: 90902
    - path: airpollpredictor/dvc_steps/enrich_pollutants.py
      md5: c67b5f17d927b9c4aef8fb27a1a1fbb8
      size: 3310
    params:
      params.yaml:
        enrich-pollutants-prev-years:
          params:
            lags-shifts:
            - 7
            - 8
            - 9
            - 10
            - 14
            - 21
            - 28
            filters:
            - weekday
            - month
            windows_filters_aqi:
              NoFilter:
              - 3D
              - 5D
              - 7D
              - 14D
              - 28D
              weekday:
              - 28D
              - 56D
              month:
              - 90D
            lag_agg_aqi:
            - 7
            - 10
            - 14
            - 21
            - 28
            methods_agg_aqi:
            - mean
            - median
            - percentile(10)
            - percentile(90)
            ewm_filters_aqi:
              NoFilter:
              - 7
              - 14
              - 21
              - 28
              weekday:
              - 28
              - 56
              month:
              - 90
          date_prev_from: '2015-01-01'
          date_prev_to: '2022-12-31'
        pollutants-codes:
        - 6001
    outs:
    - path: airpollpredictor/datasets/pollutants-enrich-data/aqi_enriched_prev_years.csv
      md5: 668232e70ddd0b78d2c3637ca31f98f4
      size: 5107413
  clean-weather-prev-years:
    cmd: python airpollpredictor/dvc_steps/clean_weather.py --input_file airpollpredictor/datasets/weather-source-data/weather_prev_years.csv
      --output_file airpollpredictor/datasets/weather-clean-data/weather_prev_years.csv
      --params params.yaml
    deps:
    - path: airpollpredictor/datasets/weather-source-data/weather_prev_years.csv
      md5: b9d38a01d54e3315e09e866a9eceb3fe
      size: 141092
    - path: airpollpredictor/dvc_steps/clean_weather.py
      md5: ef676b773e4eaacf16d36955a8df4205
      size: 1168
    params:
      params.yaml:
        weather-features:
        - tavg
        - tmin
        - tmax
        - prcp
        - wdir
        - wspd
        - wpgt
        - pres
    outs:
    - path: airpollpredictor/datasets/weather-clean-data/weather_prev_years.csv
      md5: 51da348ade83b28a04c30bf9d9a94877
      size: 278086
  clean-weather-cur-year:
    cmd: python airpollpredictor/dvc_steps/clean_weather.py --input_file airpollpredictor/datasets/weather-source-data/weather_cur_year.csv
      --output_file airpollpredictor/datasets/weather-clean-data/weather_cur_year.csv
      --params params.yaml
    deps:
    - path: airpollpredictor/datasets/weather-source-data/weather_cur_year.csv
      md5: 843fba2a74885ec79784ccb49b1f77da
      size: 8886
    - path: airpollpredictor/dvc_steps/clean_weather.py
      md5: ef676b773e4eaacf16d36955a8df4205
      size: 1168
    params:
      params.yaml:
        weather-features:
        - tavg
        - tmin
        - tmax
        - prcp
        - wdir
        - wspd
        - wpgt
        - pres
    outs:
    - path: airpollpredictor/datasets/weather-clean-data/weather_cur_year.csv
      md5: a0b0a2e82093a10566dc4a19e3ee1595
      size: 19317
  enrich-pollutants-cur-year:
    cmd: python airpollpredictor/dvc_steps/enrich_pollutants.py --input_cur_year_folder
      airpollpredictor/datasets/pollutants-aqi-no-outliers-data/cur_year/ --input_prev_years_folder
      airpollpredictor/datasets/pollutants-aqi-no-outliers-data/prev_years/ --output_file
      airpollpredictor/datasets/pollutants-enrich-data/aqi_enriched_cur_year.csv --params
      params.yaml --params_section enrich-pollutants-cur-year
    deps:
    - path: airpollpredictor/datasets/pollutants-aqi-no-outliers-data/cur_year/6001.csv
      md5: ef799710945319ba5a857bc2591df7d8
      size: 4918
    - path: airpollpredictor/datasets/pollutants-aqi-no-outliers-data/prev_years/6001.csv
      md5: 0af31f3e60fbca686d4a03f1709db07a
      size: 90902
    - path: airpollpredictor/dvc_steps/enrich_pollutants.py
      md5: c67b5f17d927b9c4aef8fb27a1a1fbb8
      size: 3310
    params:
      params.yaml:
        enrich-pollutants-cur-year:
          params:
            lags-shifts:
            - 7
            - 8
            - 9
            - 10
            - 14
            - 21
            - 28
            filters:
            - weekday
            - month
            windows_filters_aqi:
              NoFilter:
              - 3D
              - 5D
              - 7D
              - 14D
              - 28D
              weekday:
              - 28D
              - 56D
              month:
              - 90D
            lag_agg_aqi:
            - 7
            - 10
            - 14
            - 21
            - 28
            methods_agg_aqi:
            - mean
            - median
            - percentile(10)
            - percentile(90)
            ewm_filters_aqi:
              NoFilter:
              - 7
              - 14
              - 21
              - 28
              weekday:
              - 28
              - 56
              month:
              - 90
          date_prev_from: '2015-01-01'
          date_prev_to: '2022-12-31'
          date_cur_from: '2023-01-01'
          date_cur_to: '2023-06-17'
        pollutants-codes:
        - 6001
    outs:
    - path: airpollpredictor/datasets/pollutants-enrich-data/aqi_enriched_cur_year.csv
      md5: 3549c701d24efbd78e4fc4d24f0ee2d0
      size: 313868
  tune_model_lgbm_pm_25:
    cmd: python airpollpredictor/dvc_steps/tune_lgbm_model.py --input_train_file airpollpredictor/experiments_results/lgbm/6001/train.csv
      --input_val_file airpollpredictor/experiments_results/lgbm/6001/val.csv --output_metrics_file
      airpollpredictor/experiments_results/lgbm/6001/metrics.json --output_model_params_file
      airpollpredictor/experiments_results/lgbm/6001/model_params.json --output_onnx_file
      airpollpredictor/experiments_results/lgbm/6001/model.onnx --mlflow_env_file
      airpollpredictor/docker_data/env_variables.env --params params.yaml --params_section
      lgbm_pm25
    deps:
    - path: airpollpredictor/dvc_steps/tune_lgbm_model.py
      md5: 766b9d5cb5f9f3994799677d8ddf853f
      size: 7444
    - path: airpollpredictor/experiments_results/lgbm/6001/train.csv
      md5: d3f0f0e5efbeca820f3800595ac7c316
      size: 189277
    - path: airpollpredictor/experiments_results/lgbm/6001/val.csv
      md5: 910c9d29c3fd830df376bfb4d2d52805
      size: 511
    params:
      params.yaml:
        lgbm_pm25:
          exp_name: lgbm_pm25
          run_name: outliers_no_gen_lags_no
          pol_id: 6001
          categories:
          - month
          - weekday
          default_category:
          - month
          - weekday
          search_category: false
          default_top_features_count: 30
          default_params:
            n_jobs: -1
            verbosity: -1
            objective: regression
            metric: rmse
            boosting_type: gbdt
            extra_trees: true
            n_estimators: 2100
            num_leaves: 100
            learning_rate: 0.01
            subsample: 0.7
            subsample_freq: 5
            subsample_for_bin: 100000
            min_child_samples: 30
            reg_alpha: 0.1
            reg_lambda: 0.3
            max_depth: 10
            max_bin: 200
          prediction_value_type: AQI
          columns_filters:
            use_aqi_cols: true
            use_c_mean_cols: false
            use_c_max_cols: false
            use_c_median_cols: false
            use_c_min_cols: false
            use_pol_cols: false
            use_lag_cols: false
            use_gen_lags_cols: true
            use_weather_cols: true
            pollutants_codes:
            - 6001
            weather_columns:
            - tavg
            - tmin
            - tmax
            - prcp
            - wdir
            - wspd
            - wpgt
            - pres
            date_columns:
            - weekday
            - day
            - month
            - year
            - season
            - is_weekend
            - is_new_year
          columns_selected:
          - AQI_PM25
          - month
          - weekday
          - Wx
          - Wy
          - tmin
          - prcp
        metric: rmse
        optuna:
          objective: regression
          n_trials: 200
          n_jobs: 8
          cv_folders: 16
          optimization_direction: minimize
    outs:
    - path: airpollpredictor/experiments_results/lgbm/6001/metrics.json
      md5: 3579aaa3a941f02d62cbffe90276e631
      size: 66
    - path: airpollpredictor/experiments_results/lgbm/6001/model.onnx
      md5: d28143a1e728dddacf2e8b26fe81e7a3
      size: 143038
  train_model_lgbm_pm_25:
    cmd: python airpollpredictor/train_lgbm_model.py --input_train_file airpollpredictor/experiments_results/lgbm/6001/train.csv
      --input_val_file airpollpredictor/experiments_results/lgbm/6001/val.csv --input_model_params_file
      airpollpredictor/experiments_results/lgbm/6001/model_params.json --output_metrics_file
      airpollpredictor/experiments_results/lgbm/6001/metrics.json --output_onnx_file
      airpollpredictor/experiments_results/lgbm/6001/model.onnx --params params.yaml
      --params_section lgbm_pm25
    deps:
    - path: airpollpredictor/experiments_results/lgbm/6001/model_params.json
      md5: bf53e66ae7f1a50ba7840292160bd0f3
      size: 481
    - path: airpollpredictor/train_lgbm_model.py
      md5: 8f0a6979db9302ba918dc9b0ad8137fc
      size: 3868
    params:
      params.yaml:
        lgbm_pm25:
          pol_id: 6001
          categories:
          - - month
            - weekday
          - - season
            - month
          - - season
            - month
            - weekday
          default_category:
          - month
          - weekday
          search_category: true
          default_top_features_count: 30
          default_params:
            n_jobs: -1
            verbosity: -1
            objective: regression
            metric: rmse
            boosting_type: gbdt
            extra_trees: false
            n_estimators: 2100
            num_leaves: 97
            learning_rate: 0.11890042003021366
            subsample: 0.4318782580934736
            subsample_freq: 0
            subsample_for_bin: 193295
            min_child_samples: 14
            reg_alpha: 0.394194026403052
            reg_lambda: 0.708405421324422
            max_depth: 3
            max_bin: 206
          prediction_value_type: AQI
          columns_filters:
            use_aqi_cols: true
            use_c_mean_cols: false
            use_c_max_cols: false
            use_c_median_cols: false
            use_c_min_cols: false
            use_pol_cols: false
            use_lag_cols: true
            use_gen_lags_cols: true
            use_weather_cols: true
            pollutants_codes:
            - 7
            - 6001
            - 5
            - 8
            weather_columns:
            - tavg
            - tmin
            - tmax
            - prcp
            - wdir
            - wspd
            - wpgt
            - pres
            date_columns:
            - weekday
            - day
            - month
            - year
            - season
            - is_weekend
            - is_new_year
        metric: rmse
    outs:
    - path: airpollpredictor/experiments_results/lgbm/6001/metrics.json
      md5: e5efa7f76680c56b5e112aea1bb91b65
      size: 65
    - path: airpollpredictor/experiments_results/lgbm/6001/model.onnx
      md5: 4bbc6ca66a5a81406508e8a0bb14b8cd
      size: 949721
  calculate-aqi-prev-years:
    cmd: python airpollpredictor/dvc_steps/calculate_aqi.py --input_folder_prev airpollpredictor/datasets/pollutants-clean-data/prev_years
      --output_folder airpollpredictor/datasets/pollutants-aqi-data/prev_years --params
      params.yaml
    deps:
    - path: airpollpredictor/datasets/pollutants-clean-data/prev_years/6001.csv
      md5: aca49fea594b1056c3fcdeb0fe1d566a
      size: 2387732
    - path: airpollpredictor/dvc_steps/calculate_aqi.py
      md5: 999b4bb7798591cf690975e5247b76bf
      size: 1719
    params:
      params.yaml:
        pollutants-codes:
        - 6001
    outs:
    - path: airpollpredictor/datasets/pollutants-aqi-data/prev_years/6001.csv
      md5: 62805a0cb5d222c5d7886c448e8caa44
      size: 84742
  calculate-aqi-cur-year:
    cmd: python airpollpredictor/dvc_steps/calculate_aqi.py --input_folder_prev airpollpredictor/datasets/pollutants-clean-data/prev_years
      --input_folder_cur airpollpredictor/datasets/pollutants-clean-data/cur_year
      --output_folder airpollpredictor/datasets/pollutants-aqi-data/cur_year --params
      params.yaml
    deps:
    - path: airpollpredictor/datasets/pollutants-clean-data/cur_year/6001.csv
      md5: 1885f8465494136d0947827a48b7eeb6
      size: 121311
    - path: airpollpredictor/datasets/pollutants-clean-data/prev_years/6001.csv
      md5: aca49fea594b1056c3fcdeb0fe1d566a
      size: 2387732
    - path: airpollpredictor/dvc_steps/calculate_aqi.py
      md5: 999b4bb7798591cf690975e5247b76bf
      size: 1719
    params:
      params.yaml:
        pollutants-codes:
        - 6001
    outs:
    - path: airpollpredictor/datasets/pollutants-aqi-data/cur_year/6001.csv
      md5: ef799710945319ba5a857bc2591df7d8
      size: 4918
  outliers-aqi-cur-year:
    cmd: python airpollpredictor/dvc_steps/interpolate_target_outliers.py --input_folder_prev
      airpollpredictor/datasets/pollutants-aqi-data/prev_years --input_folder_cur
      airpollpredictor/datasets/pollutants-aqi-data/cur_year --output_folder airpollpredictor/datasets/pollutants-aqi-no-outliers-data/cur_year
      --params params.yaml
    deps:
    - path: airpollpredictor/datasets/pollutants-aqi-data/cur_year/6001.csv
      md5: ef799710945319ba5a857bc2591df7d8
      size: 4918
    - path: airpollpredictor/datasets/pollutants-aqi-data/prev_years/6001.csv
      md5: 62805a0cb5d222c5d7886c448e8caa44
      size: 84742
    - path: airpollpredictor/dvc_steps/interpolate_target_outliers.py
      md5: 7caf5f3dc45e0feb972996de8769e06a
      size: 1848
    params:
      params.yaml:
        outliers-aqi:
          iqr_borders:
            6001:
            - 100
            - 100
        period-settings:
          date_start_train: '2015-01-01'
          date_prev_years_end: '2022-12-31'
          date_current_year_start: '2023-01-01'
          current_date: '2023-06-17'
          last_run_date: '2023-02-12'
        pollutants-codes:
        - 6001
    outs:
    - path: airpollpredictor/datasets/pollutants-aqi-no-outliers-data/cur_year/6001.csv
      md5: ef799710945319ba5a857bc2591df7d8
      size: 4918
  outliers-aqi-prev-years:
    cmd: python airpollpredictor/dvc_steps/interpolate_target_outliers.py --input_folder_prev
      airpollpredictor/datasets/pollutants-aqi-data/prev_years --output_folder airpollpredictor/datasets/pollutants-aqi-no-outliers-data/prev_years
      --params params.yaml
    deps:
    - path: airpollpredictor/datasets/pollutants-aqi-data/prev_years/6001.csv
      md5: 62805a0cb5d222c5d7886c448e8caa44
      size: 84742
    - path: airpollpredictor/dvc_steps/interpolate_target_outliers.py
      md5: 7caf5f3dc45e0feb972996de8769e06a
      size: 1848
    params:
      params.yaml:
        pollutants-codes:
        - 6001
    outs:
    - path: airpollpredictor/datasets/pollutants-aqi-no-outliers-data/prev_years/6001.csv
      md5: 0af31f3e60fbca686d4a03f1709db07a
      size: 90902

schema: '2.0'
stages:
  download-pollutants:
    cmd: python airpollpredictor/download_pollutants.py --service_url http://127.0.0.1:8040
      --params params.yaml
    deps:
    - path: airpollpredictor/download_pollutants.py
      md5: 2a0010f2a09e2ff619ba9e13d6a2e736
      size: 594
    params:
      params.yaml:
        download-pollutants:
          end_point_current_year: download_current_year
          request_params_current_year:
            load_params:
              save_dir_path: datasets/pollutants-source-data/
              country_code: NL
              city: Rotterdam
              stations_per_pollutants:
                '7': STA-NL00418
                '5': STA-NL00418
                '6001': STA-NL00448
                '8': STA-NL00418
    outs:
    - path: airpollpredictor/datasets/pollutants-source-data/5/NL_5_28280_2023_timeseries.csv
      md5: 46959ffd3e9369956b58827e06fd3b71
      size: 546361
    - path: airpollpredictor/datasets/pollutants-source-data/6001/NL_6001_28131_2023_timeseries.csv
      md5: 1c24fd34cee2061b86cdee08795cb863
      size: 551454
    - path: airpollpredictor/datasets/pollutants-source-data/7/NL_7_28284_2023_timeseries.csv
      md5: 7a59441cb898cc490bc6e2b29c74a51a
      size: 539002
    - path: airpollpredictor/datasets/pollutants-source-data/8/NL_8_28398_2023_timeseries.csv
      md5: f87820dc5024bbd4fa09f0d4f385a233
      size: 542870
    - path: airpollpredictor/datasets/pollutants-source-data/urls/5.txt
      md5: 8f8e8a8b01a41abb25f5672f6e5c5e1d
      size: 95
    - path: airpollpredictor/datasets/pollutants-source-data/urls/6001.txt
      md5: f5a8934d7d89adf6c676bcdc3b25cf00
      size: 98
    - path: airpollpredictor/datasets/pollutants-source-data/urls/7.txt
      md5: 4e6417d315785f1c699c8810182c97af
      size: 95
    - path: airpollpredictor/datasets/pollutants-source-data/urls/8.txt
      md5: 94c2961eec0573b618ed2e0eeb335cd4
      size: 95
  download-weather:
    cmd: python airpollpredictor/download_weather.py --service_url http://127.0.0.1:8041
      --params params.yaml
    deps:
    - path: airpollpredictor/download_weather.py
      md5: cb8f8529f0cbea75d3f83a0ee8b734f2
      size: 555
    params:
      params.yaml:
        download-weather:
          end_point_current_year: download_current_year
          request_params_current_year:
            load_params:
              save_file_path: datasets/weather-source-data/weather.csv
              station_id: '06344'
    outs:
    - path: airpollpredictor/datasets/weather-source-data/weather.csv
      md5: 458a59e8a9bcd2b148b1c758dcd07c26
      size: 5152
  clean-pollutants:
    cmd: python airpollpredictor/clean_pollutants.py --input_folder airpollpredictor/datasets/pollutants-source-data/
      --output_folder airpollpredictor/datasets/pollutants-clean-data/ --params params.yaml
    deps:
    - path: airpollpredictor/clean_pollutants.py
      md5: 6a5aced4b84bab9c16c0e95e92d8964d
      size: 1639
    - path: airpollpredictor/datasets/pollutants-source-data/5/NL_5_28280_2023_timeseries.csv
      md5: 46959ffd3e9369956b58827e06fd3b71
      size: 546361
    - path: airpollpredictor/datasets/pollutants-source-data/6001/NL_6001_28131_2023_timeseries.csv
      md5: 1c24fd34cee2061b86cdee08795cb863
      size: 551454
    - path: airpollpredictor/datasets/pollutants-source-data/7/NL_7_28284_2023_timeseries.csv
      md5: 7a59441cb898cc490bc6e2b29c74a51a
      size: 539002
    - path: airpollpredictor/datasets/pollutants-source-data/8/NL_8_28398_2023_timeseries.csv
      md5: f87820dc5024bbd4fa09f0d4f385a233
      size: 542870
    params:
      params.yaml:
        pollutants-codes:
        - 7
        - 6001
        - 5
        - 8
    outs:
    - path: airpollpredictor/datasets/pollutants-clean-data/5.csv
      md5: 4b863dcea13a3f4fa5cc41a41ec2acb7
      size: 64635
    - path: airpollpredictor/datasets/pollutants-clean-data/6001.csv
      md5: a34e655c51fa4c09dc934deb426b82ac
      size: 67212
    - path: airpollpredictor/datasets/pollutants-clean-data/7.csv
      md5: f5be64cae0f587328c9545b53bc7201b
      size: 65924
    - path: airpollpredictor/datasets/pollutants-clean-data/8.csv
      md5: 94241d509ef6d6fe105000034b533780
      size: 66369
  calculate-aqi:
    cmd: python airpollpredictor/calculate_aqi.py --input_folder airpollpredictor/datasets/pollutants-clean-data/
      --output_folder airpollpredictor/datasets/pollutants-aqi-data/ --params params.yaml
    deps:
    - path: airpollpredictor/calculate_aqi.py
      md5: d4eb26fca5eb2c53a22b11bd9d1506c9
      size: 1180
    - path: airpollpredictor/datasets/pollutants-clean-data/5.csv
      md5: 4b863dcea13a3f4fa5cc41a41ec2acb7
      size: 64635
    - path: airpollpredictor/datasets/pollutants-clean-data/6001.csv
      md5: a34e655c51fa4c09dc934deb426b82ac
      size: 67212
    - path: airpollpredictor/datasets/pollutants-clean-data/7.csv
      md5: f5be64cae0f587328c9545b53bc7201b
      size: 65924
    - path: airpollpredictor/datasets/pollutants-clean-data/8.csv
      md5: 94241d509ef6d6fe105000034b533780
      size: 66369
    params:
      params.yaml:
        pollutants-codes:
        - 7
        - 6001
        - 5
        - 8
    outs:
    - path: airpollpredictor/datasets/pollutants-aqi-data/5.csv
      md5: 8ee19b52de231109408a0b8059318bc6
      size: 2816
    - path: airpollpredictor/datasets/pollutants-aqi-data/6001.csv
      md5: 9527ba94b6640aa710e1ede5f8ab3366
      size: 2831
    - path: airpollpredictor/datasets/pollutants-aqi-data/7.csv
      md5: 8052dbfc74acd5aa9c7521bd207ee9f7
      size: 2819
    - path: airpollpredictor/datasets/pollutants-aqi-data/8.csv
      md5: 76ead65667a52609adfb2fd093b2c6c3
      size: 2820
  enrich-pollutants:
    cmd: python airpollpredictor/enrich_pollutants.py --input_folder airpollpredictor/datasets/pollutants-clean-data/
      --output_file airpollpredictor/datasets/pollutants-enrich-data/aqi_enriched.csv
      --params params.yaml
    deps:
    - path: airpollpredictor/datasets/pollutants-clean-data/5.csv
      md5: 4b863dcea13a3f4fa5cc41a41ec2acb7
      size: 64635
    - path: airpollpredictor/datasets/pollutants-clean-data/6001.csv
      md5: a34e655c51fa4c09dc934deb426b82ac
      size: 67212
    - path: airpollpredictor/datasets/pollutants-clean-data/7.csv
      md5: f5be64cae0f587328c9545b53bc7201b
      size: 65924
    - path: airpollpredictor/datasets/pollutants-clean-data/8.csv
      md5: 94241d509ef6d6fe105000034b533780
      size: 66369
    - path: airpollpredictor/enrich_pollutants.py
      md5: bc5c9b62d2039f21236a73f8fe3168b2
      size: 2223
    params:
      params.yaml:
        enrich-pollutants:
          lags-shifts:
          - 7
          - 10
          - 12
          - 14
          - 21
          - 28
          filters:
          - weekday
          - month
          windows_filters_aqi:
            NoFilter:
            - 3D
            - 5D
            - 7D
            - 14D
            - 28D
            weekday:
            - 28D
            - 56D
            month:
            - 90D
          lag_agg_aqi:
          - 7
          - 10
          - 14
          - 21
          - 28
          methods_agg_aqi:
          - mean
          - median
          - percentile(10)
          - percentile(90)
          ewm_filters_aqi:
            NoFilter:
            - 7
            - 21
            - 28
            weekday:
            - 28
            - 56
            month:
            - 90
        period-settings:
          year_start_train: 2023
          forecast_period: 7
        pollutants-codes:
        - 7
        - 6001
        - 5
        - 8
    outs:
    - path: airpollpredictor/datasets/pollutants-enrich-data/aqi_enriched.csv
      md5: bdadcb50c4a980195f393fef2960df32
      size: 788985
  clean-weather:
    cmd: python airpollpredictor/clean_weather.py --input_file airpollpredictor/datasets/weather-source-data/weather.csv
      --output_file airpollpredictor/datasets/weather-clean-data/weather.csv --params
      params.yaml
    deps:
    - path: airpollpredictor/clean_weather.py
      md5: f3fbb43ebc5a1b1da827f3600b0f96e5
      size: 1221
    - path: airpollpredictor/datasets/weather-source-data/weather.csv
      md5: 458a59e8a9bcd2b148b1c758dcd07c26
      size: 5152
    params:
      params.yaml:
        weather-features:
        - tavg
        - tmin
        - tmax
        - prcp
        - wdir
        - wspd
        - wpgt
        - pres
    outs:
    - path: airpollpredictor/datasets/weather-clean-data/weather.csv
      md5: 4d7d461987f571e02850eaf93276e0c9
      size: 4946
  merge_enriched_weather:
    cmd: python airpollpredictor/merge_enriched_weather.py --input_weather_file airpollpredictor/datasets/weather-clean-data/weather.csv
      --input_aqi_file airpollpredictor/datasets/pollutants-enrich-data/aqi_enriched.csv
      --output_file airpollpredictor/datasets/pollutants-weather-merged-data/aqi_all.csv
      --params params.yaml
    deps:
    - path: airpollpredictor/datasets/pollutants-enrich-data/aqi_enriched.csv
      md5: bdadcb50c4a980195f393fef2960df32
      size: 788985
    - path: airpollpredictor/datasets/weather-clean-data/weather.csv
      md5: 4d7d461987f571e02850eaf93276e0c9
      size: 4946
    - path: airpollpredictor/merge_enriched_weather.py
      md5: 31065a4b8e462328abadfed9998d70dd
      size: 1333
    outs:
    - path: airpollpredictor/datasets/pollutants-weather-merged-data/aqi_all.csv
      md5: 81397baf9b2a9a5de69a8ad429e8f3e0
      size: 775670
